<%-include('./includes/header.ejs')  %>

</head>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<body>
  <div class="container-scroller">
    <!-- partial:../../partials/_navbar.html -->
    <%-include('./includes/headerNav.ejs')  %>

    <!-- partial -->
    <div class="main-panel">
      <div class="content-wrapper">
        <div class="row">
          <div class="col-lg-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">All Users</h4>
                <p class="card-description">
                  <!-- Add class <code>.table-striped</code> -->
                </p>
                <!-- <a href="/addproducts"><button type="button" class="btn btn-primary">Add Products</button></a> -->
                <div class="table-responsive">
                  <table class="table table-striped" id="myTable">
                    <thead>
                      <tr>
                        <th>
                          Sl no
                        </th>
                        <th>
                          Image
                        </th>
                        <th>
                          Name
                        </th>
                        <th>
                          Phone
                        </th>
                        <th>
                          Email
                        </th>
                        <th>
                          Status
                        </th>
                        <th>
                          Action
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <% allusers.forEach(allusers=> { %>
                      <% if (allusers.role!='admin') { %>
                      <tr>
                        <td class="py-1">
                          <img src="\images/faces/face8.jpg" alt="" style=" border-radius: 50%;">
                        </td>
                        <td>
                          <%= allusers.fname %>
                        </td>
                        <td>
                          <%= allusers.phone %>
                          <!-- <div class="progress">
                              <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                            </div> -->
                        </td>
                        <td>
                          <%= allusers.email %>
                        </td>
                        <td>
                          <span class="<%= allusers.status === 'Active' ? 'text-success' : 'text-danger' %>">
                            <%= allusers.status %>
                          </span>
                        </td>
                        <td>
                          <div style="margin-bottom: 5px;">
                            <% if(allusers.status=='Active'){ %>
                            <a href="" class="btn btn-sm  btn-danger" style="width: 100px;" onclick="blockUser(event,'<%=allusers._id  %>');">Block</a>

                            <% }else{ %>
                            <a href="" class="btn btn-sm btn-success" style="width: 100px;" onclick="unblockUser(event,'<%=allusers._id  %>');">Unblock</a>
                            <% } %>
                          </div>
                        </td>
                      </tr>
                      <% } %>
                      <% }); %>
                      <!-- <tr>
                          <td class="py-1">
                            <img src="../../images/faces/face2.jpg" alt="image"/>
                          </td>
                          <td>
                            Messsy Adam
                          </td>
                          <td>
                            <div class="progress">
                              <div class="progress-bar bg-danger" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </td>
                          <td>
                            $245.30
                          </td>
                          <td>
                            July 1, 2015
                          </td>
                        </tr>
                        <tr>
                          <td class="py-1">
                            <img src="../../images/faces/face3.jpg" alt="image"/>
                          </td>
                          <td>
                            John Richards
                          </td>
                          <td>
                            <div class="progress">
                              <div class="progress-bar bg-warning" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </td>
                          <td>
                            $138.00
                          </td>
                          <td>
                            Apr 12, 2015
                          </td>
                        </tr>
                        <tr>
                          <td class="py-1">
                            <img src="../../images/faces/face4.jpg" alt="image"/>
                          </td>
                          <td>
                            Peter Meggik
                          </td>
                          <td>
                            <div class="progress">
                              <div class="progress-bar bg-primary" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </td>
                          <td>
                            $ 77.99
                          </td>
                          <td>
                            May 15, 2015
                          </td>
                        </tr>
                        <tr>
                          <td class="py-1">
                            <img src="../../images/faces/face5.jpg" alt="image"/>
                          </td>
                          <td>
                            Edward
                          </td>
                          <td>
                            <div class="progress">
                              <div class="progress-bar bg-danger" role="progressbar" style="width: 35%" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </td>
                          <td>
                            $ 160.25
                          </td>
                          <td>
                            May 03, 2015
                          </td>
                        </tr>
                        <tr>
                          <td class="py-1">
                            <img src="../../images/faces/face6.jpg" alt="image"/>
                          </td>
                          <td>
                            John Doe
                          </td>
                          <td>
                            <div class="progress">
                              <div class="progress-bar bg-info" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </td>
                          <td>
                            $ 123.21
                          </td>
                          <td>
                            April 05, 2015
                          </td>
                        </tr>
                        <tr>
                          <td class="py-1">
                            <img src="../../images/faces/face7.jpg" alt="image"/>
                          </td>
                          <td>
                            Henry Tom
                          </td>
                          <td>
                            <div class="progress">
                              <div class="progress-bar bg-warning" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </td>
                          <td>
                            $ 150.00
                          </td>
                          <td>
                            June 16, 2015
                          </td>
                        </tr> -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- content-wrapper ends -->
          <!-- partial:../../partials/_footer.html -->
          <footer class="footer">
            <div class="d-sm-flex justify-content-center justify-content-sm-between">
              <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Premium <a href="https://www.bootstrapdash.com/" target="_blank">Bootstrap admin template</a> from
                BootstrapDash.</span>
              <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Copyright Â© 2021. All rights
                reserved.</span>
            </div>
          </footer>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="../../vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../js/off-canvas.js"></script>
    <script src="../../js/hoverable-collapse.js"></script>
    <script src="../../js/template.js"></script>
    <script src="../../js/settings.js"></script>
    <script src="../../js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <!-- End custom js for this page-->
    <script>
      async function blockUser(event, userId) {
        event.preventDefault(); // Prevent the default behavior of the anchor
        console.log('block user called');

        Swal.fire({
          title: "Are you sure?",
          text: "",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes"
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              type: 'POST',
              data: {
                userId: userId
              }, // Assuming you want to send productId as data
              url: '/admin/block-user', // Make sure this is the correct URL
              success: function(response) {
                // Handle the success response from the server if needed
                if (response.success) {
                  window.location.href = window.location.href
                }
              },
              error: function(error) {
                // Handle the error response from the server if needed

              }
            });

            Swal.fire({
              title: "",
              text: "",
              icon: "success"
            });
          }
        });
      }


      async function unblockUser(event, userId) {
        event.preventDefault(); // Prevent the default behavior of the anchor


        Swal.fire({
          title: "Are you sure?",
          text: "",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes"
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              type: 'POST',
              data: {
                userId: userId
              }, // Assuming you want to send productId as data
              url: '/admin/unblock-user', // Make sure this is the correct URL
              success: function(response) {
                // Handle the success response from the server if needed
                if (response.success) {
                  window.location.href = window.location.href
                }
              },
              error: function(error) {
                // Handle the error response from the server if needed
              }
            });

            Swal.fire({
              title: "",
              text: "",
              icon: "success"
            });
          }
        });
      }
    </script>


</body>



</html>

<script>
  function addSerialNumbersToTable(tableId) {
    var table = document.getElementById(tableId);
    var rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    // Iterate over the rows and add serial numbers
    for (var i = 0; i < rows.length; i++) {
      // Create a new cell for the serial number
      var cell = rows[i].insertCell(0);
      // Add the serial number to the cell (starting from 1)
      cell.textContent = i + 1;
    }
  }

  // Call the function to add serial numbers to the table with ID 'myTable'
  addSerialNumbersToTable('myTable');
</script>